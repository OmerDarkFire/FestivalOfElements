<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>פסטיבל האלמנטים</title>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
    <script>
        const banList = [
            "mewtwo-mega-x", "mewtwo-mega-y", "ditto", "deoxys-attack", "groudon-primal", "kyogre-primal",
            "shedinja", "kyurem-black", "kyurem-white", "necrozma-ultra", "dracovish", "zamazenta-crowned",
            "zacian-crowned", "calyrex-shadow", "fluttermane", "koraidon", "miraidon", "darmanitan-galar"
        ];
        const paradoxUltraBeasts = [
            "nihilego", "buzzwole", "pheromosa", "xurkitree", "celesteela", "kartana", "guzzlord", "poipole",
            "naganadel", "stakataka", "blacephalon", "ironmoth", "ironbundle", "ironhands", "ironjugulis", 
            "ironthorns", "irontreads", "ironvaliant", "greattusk", "screamtail", "brutebonnet", "fluttermane", 
            "slitherwing", "sandyshocks", "roaringmoon"
        ];
        const legendariesMythicals = [
            "articuno", "zapdos", "moltres", "mewtwo", "mew", "raikou", "entei", "suicune", "lugia", "hooh", "celebi",
            "regirock", "regice", "registeel", "latias", "latios", "kyogre", "groudon", "rayquaza", "jirachi", "deoxys",
            "uxie", "mesprit", "azelf", "dialga", "palkia", "heatran", "regigigas", "giratina", "cresselia", "phione", "manaphy",
            "darkrai", "shaymin", "arceus", "cobalion", "terrakion", "virizion", "tornadus", "thundurus", "reshiram", "zekrom",
            "landorus", "kyurem", "victini", "keldeo", "meloetta", "genesect", "xerneas", "yveltal", "zygarde", "diancie",
            "hoopa", "volcanion", "typenull", "silvally", "tapukoko", "tapulele", "tapubulu", "tapufini", "cosmog", "cosmoem",
            "solgaleo", "lunala", "necrozma", "magearna", "marshadow", "zeraora", "meltan", "melmetal", "zacian", "zamacenta",
            "eternatus", "kubfu", "urshifu", "regieleki", "regidrago", "glastrier", "spectrier", "calyrex", "enamorus", "zarude",
            "wochien", "chienpao", "tinglu", "chiyu", "koraidon", "miraidon", "okidogi", "munkidori", "fezandipiti", "ogerpon", "terapagos", "pecharunt"
        ];
        const banListMoves = ["last respects", "geomancy", "dire claw"];
        const banListItems = ["blue orb", "red orb", "mewtwonite x", "mewtwonite y", "gengarite", "ultranecrozium z"];

        const lowerCaseLists = (list) => list.map(x => x.toLowerCase());

        const lowerBanList = lowerCaseLists(banList);
        const lowerParadoxUltraBeasts = lowerCaseLists(paradoxUltraBeasts);
        const lowerLegendariesMythicals = lowerCaseLists(legendariesMythicals);
        const lowerBanListMoves = lowerCaseLists(banListMoves);
        const lowerBanListItems = lowerCaseLists(banListItems);

        function parseShowdownSet(setText) {
            const lines = setText.trim().split("\n");
            const data = { moves: [] };
            for (const line of lines) {
                const trimmedLine = line.trim();
                if (trimmedLine.includes(" @ ")) {
                    const [nickname, item] = trimmedLine.split(" @ ");
                    data.nickname = extractNicknameSpecies(nickname).nickname;
                    data.species = extractNicknameSpecies(nickname).species;
                    data.item = item.trim().toLowerCase();
                } else if (trimmedLine.startsWith("Ability:")) {
                    data.ability = trimmedLine.split(": ")[1].trim();
                } else if (trimmedLine.startsWith("Tera Type:")) {
                    data.tera_type = trimmedLine.split(": ")[1].trim();
                } else if (trimmedLine.startsWith("EVs:")) {
                    data.evs = trimmedLine.split(": ")[1].trim();
                } else if (trimmedLine.includes("Nature")) {
                    data.nature = trimmedLine.split(" ")[0].trim();
                } else if (trimmedLine.startsWith("IVs:")) {
                    data.ivs = trimmedLine.split(": ")[1].trim();
                } else if (trimmedLine.startsWith("- ")) {
                    data.moves.push(trimmedLine.slice(2).trim().toLowerCase());
                }
            }
            return data;
        }

        function extractNicknameSpecies(nickname) {
            if (nickname.includes("(") && nickname.includes(")")) {
                const species = nickname.split(" (")[1].slice(0, -1).trim().toLowerCase().replace(" ", "-");
                return { nickname: nickname.split(" (")[0].trim(), species: species };
            } else {
                return { nickname: nickname.trim(), species: nickname.toLowerCase().replace(" ", "-") };
            }
        }

        function checkBans(species, seenLegendaries, seenParadox) {
            const errors = [];
            if (lowerBanList.includes(species)) {
                errors.push(`${species} is banned.`);
            }
            if (lowerLegendariesMythicals.includes(species)) {
                if (seenLegendaries) {
                    errors.push("Only one legendary/mythical Pokémon is allowed.");
                }
                seenLegendaries = true;
            }
            if (lowerParadoxUltraBeasts.includes(species)) {
                if (seenParadox) {
                    errors.push("Only one paradox/ultra beast Pokémon is allowed.");
                }
                seenParadox = true;
            }
            return { errors, seenLegendaries, seenParadox };
        }

        function isTeamValid(team) {
            let seenLegendaries = false;
            let seenParadox = false;
            const errors = [];
            for (const pokemon of team) {
                const species = pokemon.species.toLowerCase();
                const { errors: banErrors, seenLegendaries: newSeenLegendaries, seenParadox: newSeenParadox } = checkBans(species, seenLegendaries, seenParadox);
                errors.push(...banErrors);
                seenLegendaries = newSeenLegendaries;
                seenParadox = newSeenParadox;

                for (const move of pokemon.moves) {
                    if (lowerBanListMoves.includes(move)) {
                        errors.push(`${move} is a banned move.`);
                    }
                }
                if (lowerBanListItems.includes(pokemon.item.toLowerCase())) {
                    errors.push(`${pokemon.item} is a banned item.`);
                }
            }

            if (errors.length > 0) {
                return `Invalid team: ${errors.join(" ")}`;
            }
            return "Team is valid.";
        }

        function validateTeam() {
            const teamInput = document.getElementById("teamInput").value;
            const teamData = teamInput.split("\n\n");
            const parsedTeam = teamData.map(pokemon => parseShowdownSet(pokemon));
            const validationResult = isTeamValid(parsedTeam);
            document.getElementById("result").innerText = validationResult;
        }
    </script>
</head>
<body>
    <header>
        <div class="logo-container">
            <img src="banner.png" alt="לוגו האתר" class="logo">
            <h1>פסטיבל האלמנטים</h1>
        </div>
        <nav>
            <ul>
                <li><a href="index.html">דף הבית</a></li>
                <li><a href="games.html">פוקידקס</a></li>
                <li><a href="socials.html">קישורים</a></li>
                <li><a href="challenges.html">אתגרים קודמים</a></li>
                <li><a href="team.html">צוות השרת</a></li>
            </ul>
        </nav>
    </header>    
    <main>
        <h2>ברוכים הבאים לדף הבית!</h2>
        <p>כאן תמצאו את כל המידע על פסטיבל האלמנטים.</p>
        <textarea id="teamInput" rows="10" cols="50" placeholder="הכנס את צוות הפוקימונים שלך כאן..."></textarea>
        <button onclick="validateTeam()">בדוק צוות</button>
        <div id="result"></div>
    </main>
    <footer></footer>
</body>
</html>
